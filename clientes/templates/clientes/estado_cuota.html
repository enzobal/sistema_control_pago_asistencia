{% extends "base.html" %}

{% block title %}Estado de Cuota - {{ cliente.nombre }}{% endblock %}

{% block content %}
<div class="text-center mt-4">
    <a href="{% url 'escanear_qr' %}" class="btn btn-primary btn-lg" style="background-color: #ff4500; border-color: #ff4500;">
        üì∑ Escanear otro usuario
    </a>
</div>

<div class="container mt-4">
    <h2>Estado de Cuota de {{ cliente.nombre }} {{ cliente.apellido }}</h2>

    <div class="card">
        <div class="card-body">
            <p><strong>Nombre:</strong> {{ cliente.nombre }} {{ cliente.apellido }}</p>

            <!-- √öltimo pago (en rojo si no hay pagos) -->
            <p><strong>√öltimo pago:</strong>
                {% if pagos %}
                    {{ pagos.0.fecha_pago }}
                {% else %}
                    <span style="color:red;">No hay pagos registrados</span>
                {% endif %}
            </p>

            <!-- Fecha de inicio -->
            <p><strong>Fecha de inicio:</strong> {% if pagos %} {{ pagos.0.fecha_inicio }} {% else %} - {% endif %}</p>

            <!-- Fecha de fin y comparaci√≥n con la fecha actual -->
            <p><strong>Fecha de fin:</strong>
                {% if pagos %}
                    {{ pagos.0.fecha_fin }}
                    {% comment %} Comparaci√≥n con la fecha actual {% endcomment %}
                    {% if pagos.0.fecha_fin < today_date %}
                        <span style="color:red;">El cliente debe la cuota</span>
                    {% else %}
                        <span style="color:green;">El cliente tiene la cuota al d√≠a</span>
                    {% endif %}

                    {% comment %} Tiempo transcurrido desde el √∫ltimo pago {% endcomment %}
                    {% if dias_transcurridos %}
                        <p><strong>Tiempo transcurrido desde el √∫ltimo pago (dias para vencer si el valor es negativo):</strong> {{ dias_transcurridos }} d√≠as</p>
                    {% else %}
                        <p><strong>Tiempo transcurrido desde el √∫ltimo pago :</strong> No hay pagos registrados</p>
                    {% endif %}

                {% else %}
                    -
                {% endif %}
            </p>
        </div>
    </div>

    <h3 class="mt-4">Historial de Pagos</h3>
    <table class="table table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Fecha de Pago</th>
                <th>Importe</th>
                <th>Fecha de Inicio</th>
                <th>Fecha de Fin</th>
            </tr>
        </thead>
        <tbody>
            {% for pago in pagos %}
            <tr>
                <td>{{ pago.fecha_pago }}</td>
                <td>${{ pago.importe }}</td>
                <td>{{ pago.fecha_inicio }}</td>
                <td>{{ pago.fecha_fin }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center">No hay pagos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
